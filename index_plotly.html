<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goodreads Book Insights: Ratings, Reviews, and Pages</title>

    <!-- Google Fonts: Merriweather for headings, Roboto for body -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Plotly.js CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        /* Basic Reset and Defaults */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            background-color: #f8f9fa; /* Light off-white/soft gray */
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: #2c3e50; /* Muted blue/charcoal */
            color: #ecf0f1; /* Light text for header */
            padding: 1.5rem 1rem;
            text-align: center;
            border-bottom: 3px solid #bdc3c7; /* Accent border */
        }

        header h1 {
            font-family: 'Merriweather', serif;
            font-weight: 700;
            font-size: 2.2rem;
            margin-bottom: 0.25rem;
        }
         header p {
            font-size: 1rem;
            color: #e0e0e0;
        }


        main {
            flex-grow: 1;
            width: 100%;
            max-width: 1200px; /* Max container width */
            margin: 0 auto;
            padding: 20px;
        }

        .chart-section {
            background-color: #ffffff; /* White background for chart sections */
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .chart-section h2 {
            font-family: 'Merriweather', serif;
            font-weight: 700; /* Ensure bold weight is applied */
            font-size: 1.8rem;
            margin-bottom: 5px; /* Reduced margin to bring explanation closer */
            color: #34495e; /* Darker muted blue */
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .chart-explanation {
            font-family: 'Roboto', sans-serif;
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 15px; /* Margin after the explanation */
            max-width: 90%; /* Constrain width for readability */
        }

        .chart-container {
            width: 100%;
            min-height: 450px; /* Minimum height for plots */
        }

        /* Loading Spinner Styles */
        .loading-spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease-in-out;
        }

        .spinner {
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid #8662C6; /* Muted Purple */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        footer {
            background-color: #2c3e50; /* Muted blue/charcoal */
            color: #ecf0f1;
            text-align: center;
            padding: 1rem;
            margin-top: auto; /* Pushes footer to bottom */
            font-size: 0.9rem;
        }
        footer a {
            color: #a7d7f9; /* Lighter blue for links in footer */
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }
            .chart-section h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="loading-spinner-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <header>
        <h1>Goodreads Book Insights</h1>
        <p>Exploring Relationships in Book Data: Ratings, Reviews, and Page Counts</p>
    </header>

    <main>
        <section class="chart-section" id="plot1-section">
            <h2>Reviews vs. Total Ratings</h2>
            <p class="chart-explanation" id="plot1Explanation">Loading explanation...</p>
            <div id="plot1Container" class="chart-container">
                <!-- Plotly chart 1 will be rendered here -->
            </div>
        </section>

        <section class="chart-section" id="plot2-section">
            <h2>Page Count vs. Average Rating</h2>
            <p class="chart-explanation" id="plot2Explanation">Loading explanation...</p>
            <div id="plot2Container" class="chart-container">
                <!-- Plotly chart 2 will be rendered here -->
            </div>
        </section>
    </main>

    <footer>
        <p>Data Visualization by Jules (AI Agent). Data from <a href="https://www.kaggle.com/datasets/bahramjannesarr/goodreads-book-datasets-100k" target="_blank" rel="noopener noreferrer">Goodreads 100k Books Dataset on Kaggle</a>.
        Powered by <a href="https://plotly.com/javascript/" target="_blank" rel="noopener noreferrer">Plotly.js</a>.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const plot1Container = document.getElementById('plot1Container');
            const plot2Container = document.getElementById('plot2Container');

            // Show spinner (it's visible by default, this is just for logical flow)
            loadingOverlay.classList.remove('hidden');

            async function fetchDataAndCreatePlots() {
                try {
                    const response = await fetch('goodreads_plotly_data.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log("Data loaded successfully:", data.length, "records");

                    // Hide spinner
                    loadingOverlay.classList.add('hidden');

                    if (data && data.length > 0) {
                        createPlot1(data);
                        createPlot2(data);
                    } else {
                        plot1Container.innerHTML = "<p>No data available to display plots.</p>";
                        plot2Container.innerHTML = "<p>No data available to display plots.</p>";
                    }

                } catch (error) {
                    console.error("Failed to load or process data:", error);
                    loadingOverlay.classList.add('hidden'); // Hide spinner on error too
                    plot1Container.innerHTML = `<p>Error loading data: ${error.message}. Please try again later.</p>`;
                    plot2Container.innerHTML = `<p>Error loading data: ${error.message}. Please try again later.</p>`;
                }
            }

            function createPlot1(data) {
                const trace1 = {
                    x: data.map(d => d.reviews),
                    y: data.map(d => d.totalratings),
                    type: 'histogram2d',
                    colorscale: 'Blues', // Muted blue theme
                    reversescale: false, // Darker for more concentration
                    showscale: true, // Show color scale bar
                    xbins: {
                        size: 50 // Adjust bin size as needed, depends on data range after IQR
                    },
                    ybins: {
                        size: 2000 // Adjust bin size as needed
                    },
                    hovertemplate: 'Reviews: %{x}<br>Total Ratings: %{y}<br>Count: %{z}<extra></extra>'
                };

                const layout1 = {
                    title: {
                        text: 'Book Concentration: Review Count vs. Total Ratings',
                        font: { family: 'Merriweather, serif', size: 18, color: '#34495E' }
                    },
                    xaxis: {
                        title: 'Number of Text Reviews',
                        titlefont: { family: 'Roboto, sans-serif', size: 14, color: '#555' },
                        gridcolor: '#e9e9e9',
                        zerolinecolor: '#d9d9d9'
                    },
                    yaxis: {
                        title: 'Total Number of Ratings Received',
                        titlefont: { family: 'Roboto, sans-serif', size: 14, color: '#555' },
                        gridcolor: '#e9e9e9',
                        zerolinecolor: '#d9d9d9'
                    },
                    plot_bgcolor: '#fdfdfd',
                    paper_bgcolor: '#ffffff',
                    margin: { l: 70, r: 30, b: 60, t: 70, pad: 4 },
                    font: { family: 'Roboto, sans-serif', color: '#333' }
                };

                const config = { responsive: true, displaylogo: false };
                Plotly.newPlot(plot1Container, [trace1], layout1, config);
                document.getElementById('plot1Explanation').textContent = "Shows the concentration of books based on their number of text reviews and total ratings. Darker areas indicate more books in that specific review/rating range.";
            }

            function createPlot2(data) {
                // Data for box plots needs to be grouped by page_group
                // Plotly can do this if we provide x as page_group and y as rating for each point.
                // Or, we can create one trace per page_group. The former is simpler.

                const trace2 = {
                    type: 'box',
                    x: data.map(d => d.page_group), // Page groups
                    y: data.map(d => d.rating),    // Average ratings
                    // To ensure order, we might need to sort unique page_groups if Plotly doesn't by default.
                    // The `page_labels` from preprocessing are already sorted.
                    // Plotly should respect the order of appearance for categorical axes if not specified.
                    // Let's define the order explicitly to be safe, matching preprocess_plotly.py
                    // categoryorder: 'array',
                    // categoryarray: ['0-100', '101-200', '201-300', '301-400', '401-500', '501-600', '601-700', '701-800', '800+'],
                    // The above categoryorder is a layout property, not trace.

                    boxpoints: 'outliers', // Show outliers
                    jitter: 0.3, // Spread out points if showing all points
                    pointpos: -1.8, // Position of points
                    marker: {
                        color: '#8662C6', // Muted Purple
                        // opacity: 0.7 // Opacity for individual points if shown
                    },
                    line: {
                        color: '#503A77' // Darker purple for box lines
                    },
                    // hovertemplate: not as straightforward for box plots per point unless using 'all' boxpoints.
                    // Default hover for box plots shows summary stats (median, quartiles, etc.)
                };

                const layout2 = {
                    title: {
                        text: 'Distribution of Book Ratings by Page Count Category',
                        font: { family: 'Merriweather, serif', size: 18, color: '#34495E' }
                    },
                    xaxis: {
                        title: 'Page Count Category',
                        titlefont: { family: 'Roboto, sans-serif', size: 14, color: '#555' },
                        type: 'category', // Ensure it's treated as categorical
                        // Explicitly set category order to match bins from preprocessing
                        categoryorder: 'array',
                        categoryarray: ['0-100', '101-200', '201-300', '301-400', '401-500', '501-600', '601-700', '701-800', '800+'].filter(
                            // Filter out empty categories to prevent display issues if some groups have no data
                            // This requires knowing which groups have data, or Plotly might handle empty categories gracefully.
                            // Let's rely on Plotly to handle potentially empty categories from the full list.
                            // If a category in categoryarray has no data points, it's usually just not drawn.
                            label => data.some(d => d.page_group === label)
                        ),
                        gridcolor: '#e9e9e9',
                        zerolinecolor: '#d9d9d9'
                    },
                    yaxis: {
                        title: 'Average Rating (out of 5)',
                        titlefont: { family: 'Roboto, sans-serif', size: 14, color: '#555' },
                        gridcolor: '#e9e9e9',
                        zerolinecolor: '#d9d9d9',
                        range: [0, 5.2] // Ratings are typically 0-5
                    },
                    plot_bgcolor: '#fdfdfd',
                    paper_bgcolor: '#ffffff',
                    margin: { l: 70, r: 30, b: 80, t: 70, pad: 4 }, // Increased bottom margin for category labels
                    font: { family: 'Roboto, sans-serif', color: '#333' }
                };
                // Refine categoryarray to only include groups present in the data to avoid empty spaces
                const presentPageGroups = [...new Set(data.map(d => d.page_group))].sort((a, b) => {
                    const order = ['0-100', '101-200', '201-300', '301-400', '401-500', '501-600', '601-700', '701-800', '800+'];
                    return order.indexOf(a) - order.indexOf(b);
                });
                layout2.xaxis.categoryarray = presentPageGroups;


                const config = { responsive: true, displaylogo: false };
                Plotly.newPlot(plot2Container, [trace2], layout2, config);
                document.getElementById('plot2Explanation').textContent = "Displays the distribution of average ratings (median, quartiles, outliers) for books, grouped by different page count categories.";
            }

            fetchDataAndCreatePlots();
        });
    </script>
</body>
</html>
